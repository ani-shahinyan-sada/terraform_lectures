# Service Account Module

## Overview
Creates a service account that provides identity and authentication for all VMs. This account is granted permissions to read startup scripts from Cloud Storage.

## Resources Created
- `google_service_account` - Service account with specified ID and display name

## Usage

```hcl
module "serviceacc" {
  source = "./modules/service_account"
  
  service_account_display_name = "Monitoring Service Account"
  project_id                   = var.project_id
  service_account_id           = "monitoring-sa"
}
```

## Inputs

| Variable | Type | Required | Description |
|----------|------|----------|-------------|
| `service_account_id` | string | yes | unique identifier for service account (e.g., 'sirelidevserviceaccount'), passed from root variable, combined with project to form email: id@project.iam.gserviceaccount.com |
| `service_account_display_name` | string | yes | human-readable name shown in gcp console (e.g., 'sireli dev service account jan'), passed from root variable, for identification purposes only |
| `project_id` | string | yes | gcp project id where service account will be created, passed from root variable |

## Outputs

| Output | Type | Description | Used By |
|--------|------|-------------|---------|
| `service_account_email` | string | full email of the created service account (format: id@project.iam.gserviceaccount.com), should be used instead of manual construction in main.tf for gce and iam modules | GCE and IAM modules (recommended) |
| `service_account_id` | string | account id portion of the service account, useful for verification | Not currently used |
| `service_account_name` | string | full resource name of service account (format: projects/{{project}}/serviceAccounts/{{email}}), useful for additional iam bindings | Not currently used |

## Configuration Details

### Service Account Email Format
The service account email is automatically generated by GCP in the format:
```
{service_account_id}@{project_id}.iam.gserviceaccount.com
```

### Current Implementation vs Recommendation
**Current:** The email is manually constructed in main.tf:
```hcl
service_account_email = "${var.service_account_id}@${var.project_id}.iam.gserviceaccount.com"
```

**Recommended:** Use the module output instead:
```hcl
service_account_email = module.serviceacc.service_account_email
```

Benefits of using the output:
- Uses the actual created resource value
- Avoids potential typos in manual construction
- Makes the dependency explicit in terraform's dependency graph
- Future-proof if Google changes email format

### Permissions
This service account is granted the following permissions via the IAM module:
- `roles/storage.objectViewer` on the startup scripts bucket
- This allows VMs to download and execute their startup scripts

## Dependencies
None - this module should be created early as it's referenced by IAM and GCE modules.

## Notes
- Single service account shared by all VMs
- VMs authenticate as this service account to access GCP APIs
- The `scopes` parameter on VMs determines what APIs the service account can access
- Currently using `cloud-platform` scope which grants full GCP API access